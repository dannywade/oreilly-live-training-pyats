---
- name: Confirm BGP network statements fall in the 10.0.0.0/8 subnet
  ansible.builtin.assert:
    that:
      - "'10.0.0.0/8' | ansible.utils.network_in_network(item.network)"
    fail_msg: "{{ item.network }} does not belong to a valid subnet"
    success_msg: "{{ item.network }}: <OK>"
    quiet: true
  loop: "{{ bgp.networks }}"

- name: Render BGP configuration
  ansible.builtin.set_fact:
    rendered_config: "{{ lookup('ansible.builtin.template', 'bgp_global.j2') }}"

- name: Print rendered BGP configuration
  ansible.builtin.debug:
    msg: rendered_config

- name: Apply rendered BGP configuration
  cisco.ios.ios_config:
    src: rendered_config
